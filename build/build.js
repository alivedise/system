var utils=require("utils"),SystemAppBuilder=function(){};SystemAppBuilder.prototype.setOptions=function(e){this.stageDir=utils.getFile(e.STAGE_APP_DIR),this.appDir=utils.getFile(e.APP_DIR),this.distDirPath=e.GAIA_DISTRIBUTION_DIR},SystemAppBuilder.prototype.addCustomizeFiles=function(){if(!utils.getFile(this.distDirPath,"power").exists())return;var e=this,t=utils.getFile(this.distDirPath,"power"),n=utils.ls(t);n.forEach(function(t){utils.copyFileTo(t.path,utils.joinPath(e.stageDir.path,"resources","power"),t.leafName)})},SystemAppBuilder.prototype.initConfigJsons=function(){var e={defaultURL:"http://www.mozilla.org/en-US/firefoxos/"},t={},n={},r=utils.getFile(this.stageDir.path,"resources","icc.json"),i=utils.getFile(this.stageDir.path,"resources","wapuaprof.json"),s=utils.getFile(this.stageDir.path,"resources","eu-roaming.json");utils.writeContent(r,utils.getDistributionFileContent("icc",e,this.distDirPath)),utils.writeContent(i,utils.getDistributionFileContent("wapuaprof",t,this.distDirPath)),utils.writeContent(s,utils.getDistributionFileContent("eu-roaming",n,this.distDirPath))},SystemAppBuilder.prototype.integrateLockScreen=function(e){var t=e.STAGE_APP_DIR,n='<div id="lockscreen-frame-placeholder"></div>',r=[t,"lockscreen","lockscreen.html"],i=[t,"index.html"],s=utils.getFile.apply(utils,i),o=utils.getFileContent(utils.getFile.apply(utils,r)),u=utils.getFileContent(s),a=u.replace(n,o);utils.writeContent(s,a)},SystemAppBuilder.prototype.integrateLockScreenInputpad=function(e){var t=e.STAGE_APP_DIR,n='<div id="lockscreen-inputpad-frame-placeholder"></div>',r=[t,"lockscreen","lockscreen_inputpad_frame.html"],i=[t,"index.html"],s=utils.getFile.apply(utils,i),o=utils.getFileContent(utils.getFile.apply(utils,r)),u=utils.getFileContent(s),a=u.replace(n,o);utils.writeContent(s,a)},SystemAppBuilder.prototype.inlineDeviceType=function(e){var t=e.STAGE_APP_DIR,n=e.GAIA_DEVICE_TYPE,r=[t,"js","feature_detector.js"],i=utils.getFile.apply(utils,r),s=utils.getFileContent(i);utils.writeContent(i,s.replace(/this\.deviceType = \'_GAIA_DEVICE_TYPE_\';/,"this.deviceType = '"+n+"';"))},SystemAppBuilder.prototype.execute=function(e){utils.copyToStage(e),this.setOptions(e),this.initConfigJsons(),this.distDirPath&&this.addCustomizeFiles(),this.integrateLockScreen(e),this.integrateLockScreenInputpad(e),this.inlineDeviceType(e)},exports.execute=function(e){(new SystemAppBuilder).execute(e)};